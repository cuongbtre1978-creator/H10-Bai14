<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Learning: T√≠nh enthalpy c·ªßa ph·∫£n ·ª©ng</title>
    <style>
        :root {
            /* C·ªôt tr√°i */
            --left-bg: #0b1d3a;
            --left-border: #4caf50;
            --menu-btn-bg: #ffd54f;
            --menu-btn-text: #0d47a1;
            
            /* C·ªôt gi·ªØa */
            --center-bg: #4e342e;
            --center-border: #ff9800;
            
            /* V√πng hi·ªÉn th·ªã (display-area) */
            --display-bg: #2a0a2a;
            --display-border: #ce93d8;
            --display-text: #ffe0b2;
            
            /* C·ªôt ph·∫£i */
            --right-bg: #827717;
            --right-border: #ffeb3b;
            
            /* Kh√°c */
            --success: #4caf50;
            --error: #f44336;
            --info: #00bcd4;
            --warning: #ffeb3b;
            --modal-bg: #222222;
            --modal-text: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        html, body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background-color: #000;
            color: #fff;
        }

        .main-container {
            display: flex;
            flex-direction: row;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            padding: 5px;
            gap: 5px;
        }

        /* T·ªâ l·ªá 1 : 2 : 1 */
        .left-panel {
            flex: 1;
            background-color: var(--left-bg);
            border: 2px solid var(--left-border);
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 10px;
        }

        .center-panel {
            flex: 2;
            background-color: var(--center-bg);
            border: 2px solid var(--center-border);
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 10px;
        }

        .right-panel {
            flex: 1;
            background-color: var(--right-bg);
            border: 2px solid var(--right-border);
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 15px;
        }

        /* Thanh cu·ªôn c·ªôt ph·∫£i */
        .right-panel::-webkit-scrollbar {
            width: 8px;
        }
        .right-panel::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        .right-panel::-webkit-scrollbar-thumb {
            background: var(--right-border);
            border-radius: 4px;
        }

        /* --- C·ªôt Tr√°i: Menu --- */
        .menu-title {
            color: #fff;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.1rem;
            text-transform: uppercase;
            border-bottom: 1px dashed var(--left-border);
            padding-bottom: 5px;
        }

        .menu-container {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .menu-btn {
            background-color: var(--menu-btn-bg);
            color: var(--menu-btn-text);
            font-weight: bold;
            border: none;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .menu-btn:active {
            transform: scale(0.98);
        }
        .submenu-container {
            display: none;
            padding-left: 15px;
            margin-bottom: 10px;
        }
        .submenu-item {
            color: #fff;
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            font-size: 0.9rem;
        }
        .submenu-item:hover {
            background-color: rgba(255,255,255,0.1);
        }
        .submenu-item.completed {
            color: var(--success);
        }

        .complete-content-btn {
            background-color: var(--success);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            display: none;
            text-align: center;
        }
        .complete-content-btn:disabled {
            background-color: gray;
            cursor: not-allowed;
        }

        /* --- C·ªôt Gi·ªØa: V√πng hi·ªÉn th·ªã --- */
        .display-area {
            flex: 1;
            background-color: var(--display-bg);
            border: 2px solid var(--display-border);
            border-radius: 10px;
            color: var(--display-text);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Kh√≥a cu·ªôn v√πng cha */
            position: relative;
        }

        .display-content {
            flex: 1;
            overflow-y: auto; /* Cho ph√©p cu·ªôn v√πng con */
            max-height: 100%;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
            padding-bottom: 40px; /* Nh∆∞·ªùng ch·ªó cho t√™n gi√°o vi√™n */
        }

        .teacher-name {
            position: absolute;
            bottom: 5px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            pointer-events: none;
            z-index: 10;
        }

        /* --- Intro View --- */
        .intro-view {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .intro-title {
            font-size: 2rem;
            color: var(--center-border);
            margin-bottom: 10px;
        }
        .intro-subtitle {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        /* --- Quiz View --- */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #aaa;
        }
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--display-border);
            color: var(--display-text);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            font-size: 1rem;
        }
        .option-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        .option-btn.selected {
            background: var(--center-border);
            color: #000;
            font-weight: bold;
        }
        .option-btn.correct { background: var(--success); color: #fff; }
        .option-btn.wrong { background: var(--error); color: #fff; }

        .input-text, .input-textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--display-border);
            background: rgba(0,0,0,0.3);
            color: var(--display-text);
            font-size: 1rem;
            margin-bottom: 10px;
        }
        .input-textarea {
            height: 100px;
            resize: none;
        }
        .input-correct { border: 2px solid var(--success) !important; }
        .input-wrong { border: 2px solid var(--error) !important; }

        .btn-action {
            background: var(--info);
            color: #fff;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            font-size: 1rem;
            width: 100%;
        }
        .btn-action:disabled { background: gray; cursor: not-allowed; }

        /* --- Result View --- */
        .result-view {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .score-display {
            font-size: 4rem;
            font-weight: bold;
            margin: 20px 0;
        }
        .rank-xs { color: var(--success); font-size: 1.5rem; font-weight: bold; }
        .rank-g { color: var(--info); font-size: 1.5rem; font-weight: bold; }
        .rank-k { color: var(--warning); font-size: 1.5rem; font-weight: bold; }
        .rank-tb { color: var(--error); font-size: 1.5rem; font-weight: bold; }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
        .btn-result {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-nop { background: var(--error); color: white; }
        .btn-nop:disabled { background: gray; }
        .btn-review { background: var(--info); color: white; }
        .btn-retry { background: var(--warning); color: black; }

        /* --- C·ªôt Ph·∫£i: Form & Config --- */
        .right-header {
            color: var(--right-border);
            text-transform: uppercase;
            border-bottom: 1px dashed var(--right-border);
            padding-bottom: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            margin-top: 15px;
        }
        .right-header:first-child { margin-top: 0; }
        
        .form-group {
            margin-bottom: 10px;
        }
        .form-group label {
            display: block;
            font-size: 0.8rem;
            margin-bottom: 3px;
            color: #ccc;
        }
        .form-input {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.2);
            color: #fff;
        }
        .form-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-list {
            font-size: 0.8rem;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            list-style-type: none;
        }
        .stats-list li { margin-bottom: 5px; }

        .btn-start {
            background: var(--error);
            color: #fff;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        .btn-start:disabled { background: gray; cursor: not-allowed; }
        .btn-small {
            background: rgba(255,255,255,0.2);
            color: #fff;
            border: none;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 5px;
            font-size: 0.8rem;
        }
        
        .sound-toggle {
            text-align: center;
            font-size: 1.5rem;
            cursor: pointer;
            margin-top: 10px;
        }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content-box {
            background: var(--modal-bg);
            color: var(--modal-text);
            border: 2px solid var(--info);
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        .modal-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: var(--info);
        }
        .modal-close {
            cursor: pointer;
            font-size: 1.5rem;
            color: #fff;
        }
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        /* C·ª• th·ªÉ cho b·∫£ng review */
        .review-table {
            width: 100%;
            border-collapse: collapse;
        }
        .review-table th, .review-table td {
            border: 1px solid rgba(255,255,255,0.2);
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }
        .review-table th { background: rgba(0,0,0,0.5); }
        .review-row-correct { background: rgba(76, 175, 80, 0.1); border-left: 4px solid var(--success); }
        .review-row-wrong { background: rgba(244, 67, 54, 0.1); border-left: 4px solid var(--error); }

        /* Modal con Quiz (hi·ªÉn th·ªã c√¢u h·ªèi h·ªçc t·∫≠p) */
        .modal-quiz-btn {
            background: var(--info); border: none; padding: 10px; border-radius: 5px; color: #fff; cursor: pointer; margin-top: 15px;
        }

        /* Responsive constraints b·∫£o v·ªá layout 1:2:1 */
        @media (max-width: 768px) {
            .menu-btn { font-size: 0.8rem; padding: 8px; }
            .submenu-item { font-size: 0.75rem; }
            .intro-title { font-size: 1.5rem; }
            .btn-start { font-size: 0.9rem; padding: 10px; }
            .right-panel { padding: 10px; }
            .display-content { padding: 10px; }
        }
    </style>
</head>
<body>

<div class="main-container">
    <!-- C·ªôt Tr√°i -->
    <div class="left-panel">
        <div class="menu-title">N·ªòI DUNG B√ÄI H·ªåC</div>
        <div class="menu-container" id="menu-container">
            <!-- Render Menu JS -->
        </div>
        <button id="btn-complete-content" class="complete-content-btn" onclick="completeContent()" disabled>HO√ÄN TH√ÄNH PH·∫¶N N·ªòI DUNG</button>
    </div>

    <!-- C·ªôt Gi·ªØa -->
    <div class="center-panel">
        <div class="display-area">
            <div class="display-content" id="display-content">
                <!-- N·ªôi dung ƒë·ªông -->
            </div>
            <div class="teacher-name">C√¥ Nguy·ªÖn Ng·ªçc Tuy·∫øt - Th·∫ßy L√™ Nguy·ªÖn C∆∞·ªùng</div>
        </div>
    </div>

    <!-- C·ªôt Ph·∫£i -->
    <div class="right-panel">
        <div class="right-header">Th√¥ng tin h·ªçc sinh</div>
        <div class="form-group">
            <label>M√£ h·ªçc sinh (*)</label>
            <input type="text" id="hs-ma" class="form-input" disabled>
        </div>
        <div class="form-group">
            <label>H·ªç v√† t√™n (*)</label>
            <input type="text" id="hs-ten" class="form-input" disabled>
        </div>
        <div class="form-group">
            <label>L·ªõp (*)</label>
            <input type="text" id="hs-lop" class="form-input" disabled>
        </div>

        <div class="right-header">C·∫•u h√¨nh b√†i t·∫≠p</div>
        <div class="form-group">
            <label>T·ªïng s·ªë c√¢u (N) [5 - 25]</label>
            <input type="number" id="numQuestions" class="form-input" value="10" min="5" max="25" onchange="calculateDist()" disabled>
        </div>
        <ul class="stats-list">
            <li>Tr·∫Øc nghi·ªám (40%): <span id="dist-mcq">4</span></li>
            <li>ƒê√∫ng/Sai (20%): <span id="dist-tf">2</span></li>
            <li>Tr·∫£ l·ªùi ng·∫Øn (20%): <span id="dist-sa">2</span></li>
            <li>T·ª± lu·∫≠n (20%): <span id="dist-es">2</span></li>
        </ul>

        <div class="right-header">C√°c d·∫°ng b√†i</div>
        <ul class="stats-list">
            <li>1. Tr·∫Øc nghi·ªám 4 l·ª±a ch·ªçn</li>
            <li>2. ƒê√∫ng/Sai</li>
            <li>3. Tr·∫£ l·ªùi ng·∫Øn</li>
            <li>4. T·ª± lu·∫≠n</li>
        </ul>

        <button id="btn-start" class="btn-start" onclick="startGame()" disabled>B·∫ÆT ƒê·∫¶U L√ÄM B√ÄI</button>
        <button class="btn-small" onclick="showIntro()">H·ªçc l·∫°i b√†i (Intro)</button>
        <button class="btn-small" onclick="resetAll()">Reset b√†i t·∫≠p</button>
        
        <div class="sound-toggle" onclick="toggleSound()" id="sound-icon">üîä</div>
    </div>
</div>

<!-- Modal N·ªôi dung b√†i h·ªçc -->
<div class="modal-overlay" id="content-modal">
    <div class="modal-content-box">
        <div class="modal-header">
            <span id="modal-title">Ti√™u ƒë·ªÅ</span>
            <span class="modal-close" onclick="closeModal('content-modal')">&times;</span>
        </div>
        <div class="modal-body" id="modal-body-content">
            <!-- N·ªôi dung HTML -->
        </div>
    </div>
</div>

<!-- Modal K·∫øt qu·∫£ -->
<div class="modal-overlay" id="review-modal">
    <div class="modal-content-box">
        <div class="modal-header">
            <span>XEM L·∫†I B√ÄI L√ÄM</span>
            <span class="modal-close" onclick="closeModal('review-modal')">&times;</span>
        </div>
        <div class="modal-body">
            <table class="review-table">
                <thead>
                    <tr>
                        <th style="width: 50%;">ƒê√ÅP √ÅN H·ªÜ TH·ªêNG</th>
                        <th style="width: 50%;">B√ÄI L√ÄM C·ª¶A H·ªåC SINH</th>
                    </tr>
                </thead>
                <tbody id="review-tbody">
                    <!-- Gen b·∫±ng JS -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- TH√äM M·ªöI: Modal Xem k·∫øt qu·∫£ ri√™ng cho Ph·∫ßn B√†i T·∫≠p T∆∞∆°ng T√°c -->
<div class="modal-overlay" id="modal-quiz-review" style="z-index: 1001;">
    <div class="modal-content-box">
        <div class="modal-header">
            <span>XEM K·∫æT QU·∫¢ CHI TI·∫æT PH·∫¶N B√ÄI T·∫¨P</span>
            <span class="modal-close" onclick="closeModalQuizReview()">&times;</span>
        </div>
        <div class="modal-body">
            <table class="review-table">
                <thead>
                    <tr>
                        <th style="width: 50%;">ƒê√ÅP √ÅN H·ªÜ TH·ªêNG</th>
                        <th style="width: 50%;">B√ÄI L√ÄM C·ª¶A H·ªåC SINH</th>
                    </tr>
                </thead>
                <tbody id="modal-quiz-review-tbody">
                    <!-- Gen b·∫±ng JS -->
                </tbody>
            </table>
            <div style="text-align:center; margin-top:20px;">
                <button class="btn-action" style="width:auto; padding:10px 30px; background: var(--error);" onclick="closeModalQuizReview()">ƒê√ìNG</button>
            </div>
        </div>
    </div>
</div>

<script>
    // URL Google Apps Script Web App
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzieem1_ey6tHtjqxsa6mbgZjocsv2jLlGysC8zPBzyUcWL4g_0aXriRFgRN6lhx21M/exec";

    // --- D·ªÆ LI·ªÜU B√ÄI H·ªåC (lessonData) ---
    const lessonData = [
        {
            id: "bai14",
            title: "B√ÄI 14: T√≠nh bi·∫øn thi√™n enthalpy c·ªßa ph·∫£n ·ª©ng h√≥a h·ªçc",
            subs: [
                {
                    id: "muc1",
                    title: "I. L√ù THUY·∫æT",
                    subs: [
                        {
                            id: "muc1_1",
                            title: "I.1. X√°c ƒë·ªãnh bi·∫øn thi√™n enthalpy c·ªßa ph·∫£n ·ª©ng d·ª±a v√†o nƒÉng l∆∞·ª£ng li√™n k·∫øt",
                            items: [
                                {
                                    t: "C√¥ng th·ª©c",
                                    c: `<b>C√¥ng th·ª©c:</b><br>
                                        Cho ph·∫£n ·ª©ng t·ªïng qu√°t ·ªü ƒëi·ªÅu ki·ªán chu·∫©n:<br>
                                        aA(g) + bB(g) ‚Üí mM(g) + nN(g)<br>
                                        T√≠nh Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> c·ªßa ph·∫£n ·ª©ng khi bi·∫øt c√°c gi√° tr·ªã nƒÉng l∆∞·ª£ng li√™n k·∫øt (E<sub>b</sub>) theo c√¥ng th·ª©c:<br><br>
                                        Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = [a.E<sub>b</sub>(A) + b.E<sub>b</sub>(B)] ‚Äì [m.E<sub>b</sub>(M) + n.E<sub>b</sub>(N)]<br><br>
                                        T·ªïng qu√°t:<br>
                                        Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëE<sub>b</sub>(cd) - ‚àëE<sub>b</sub>(sp)`
                                },
                                {
                                    t: "V√≠ d·ª• 1",
                                    c: `<b>V√≠ d·ª• 1:</b><br>
                                        Cho bi·∫øt nƒÉng l∆∞·ª£ng li√™n k·∫øt sau: E<sub>b</sub>(H-H) = 432 kJ/mol; E<sub>b</sub>(O=O) = 498 kJ/mol; E<sub>b</sub>(O-H) = 467 kJ/mol. H√£y t√≠nh bi·∫øn thi√™n enthalpy c·ªßa ph·∫£n ·ª©ng sau:<br>
                                        2H<sub>2</sub>(g) + O<sub>2</sub>(g) ‚Üí 2H<sub>2</sub>O(g)<br><br>
                                        <b>H∆∞·ªõng d·∫´n:</b><br>
                                        Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = 2.E<sub>b</sub>(H<sub>2</sub>) + E<sub>b</sub>(O<sub>2</sub>) ‚Äì 2.E<sub>b</sub>(H<sub>2</sub>O)<br>
                                        = 2.E<sub>b</sub>(H-H) + E<sub>b</sub>(O=O) ‚Äì 2.2.E<sub>b</sub>(O-H)<br>
                                        = 2.432 + 498 ‚Äì 2.2.467 = -506 kJ`
                                }
                            ]
                        },
                        {
                            id: "muc1_2",
                            title: "I.2. X√°c ƒë·ªãnh bi·∫øn thi√™n enthalpy c·ªßa ph·∫£n ·ª©ng d·ª±a v√†o enthalpy t·∫°o th√†nh",
                            items: [
                                {
                                    t: "C√¥ng th·ª©c",
                                    c: `<b>C√¥ng th·ª©c:</b><br>
                                        Cho ph∆∞∆°ng tr√¨nh h√≥a h·ªçc t·ªïng qu√°t: aA + bB ‚Üí mM + nN<br>
                                        T√≠nh Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> khi bi·∫øt c√°c gi√° tr·ªã Œî<sub>f</sub>H<sup>0</sup><sub>298</sub> c·ªßa t·∫•t c·∫£ c√°c ch·∫•t ƒë·∫ßu v√† s·∫£n ph·∫©m theo c√¥ng th·ª©c sau:<br><br>
                                        Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = [m.Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(M) + n.Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(N)] ‚Äì [a.Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(A) + b.Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(B)]<br><br>
                                        T·ªïng qu√°t:<br>
                                        Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(sp) - ‚àëŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(cd)`
                                },
                                {
                                    t: "V√≠ d·ª• 2",
                                    c: `<b>V√≠ d·ª• 2:</b><br>
                                        Cho ph·∫£n ·ª©ng: 2SO<sub>2</sub>(g) + O<sub>2</sub>(g) ‚Üí 2SO<sub>3</sub>(l)<br>
                                        Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àí288,4 kJ<br>
                                        T√≠nh nhi·ªát t·∫°o th√†nh chu·∫©n c·ªßa kh√≠ SO<sub>2</sub> bi·∫øt Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(SO<sub>3</sub>(l)) = ‚àí 441,0 kJ/mol.<br><br>
                                        <b>H∆∞·ªõng d·∫´n:</b><br>
                                        Ta c√≥:<br>
                                        Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = 2√óŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(SO<sub>3</sub>(l)) - 2√óŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(SO<sub>2</sub>(g)) ‚àí Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(O<sub>2</sub>(g))<br>
                                        -288,4 = 2√ó(‚àí441,0) - 2√óŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(SO<sub>2</sub>(g)) ‚àí 0<br>
                                        ‚Üí Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(SO<sub>2</sub>(g)) = ‚àí 296,8 kJ/mol`
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "muc2",
                    title: "II. B√ÄI T·∫¨P R√àN LUY·ªÜN",
                    subs: [
                        { id: "muc2_1", title: "Ph·∫ßn 1. Tr·∫Øc nghi·ªám 4 l·ª±a ch·ªçn", type: "quiz", questions: [0,1,2,3,4,5,6,7,8,9,10,11] },
                        { id: "muc2_2", title: "Ph·∫ßn 2. Tr·∫Øc nghi·ªám ƒë√∫ng ‚Äì sai", type: "quiz", questions: [12,13,14,15,16,17,18,19] },
                        { id: "muc2_3", title: "Ph·∫ßn 3. Tr·∫Øc nghi·ªám tr·∫£ l·ªùi ng·∫Øn", type: "quiz", questions: [20,21,22,23] }
                    ]
                }
            ]
        }
    ];

    // --- NG√ÇN H√ÄNG C√ÇU H·ªéI (25 c√¢u - Sinh t·ª´ n·ªôi dung l√Ω thuy·∫øt & b√†i t·∫≠p SGK) ---
    // Type 1: MCQ, 2: T/F (a: 0=ƒê, 1=S), 3: Short, 4: Essay (k: array keywords)
    const qBank = [
        // Type 1: T·ª´ "Ph·∫ßn 1. Tr·∫Øc nghi·ªám 4 l·ª±a ch·ªçn" (12 c√¢u)
        { type: 1, q: "Trong m·ªôt ph·∫£n ·ª©ng h√≥a h·ªçc, qu√° tr√¨nh ph√° v·ª° c√°c li√™n k·∫øt h√≥a h·ªçc c·ªßa ch·∫•t ƒë·∫ßu l√† qu√° tr√¨nh", opts: ["A. T·ªèa nhi·ªát (gi·∫£i ph√≥ng nƒÉng l∆∞·ª£ng).", "B. Thu nhi·ªát (c·∫ßn cung c·∫•p nƒÉng l∆∞·ª£ng).", "C. Kh√¥ng thay ƒë·ªïi nƒÉng l∆∞·ª£ng.", "D. V·ª´a t·ªèa nhi·ªát v·ª´a thu nhi·ªát."], a: 1 },
        { type: 1, q: "Qu√° tr√¨nh h√¨nh th√†nh c√°c li√™n k·∫øt h√≥a h·ªçc c·ªßa s·∫£n ph·∫©m l√† qu√° tr√¨nh:", opts: ["A. Thu nhi·ªát.", "B. T·ªèa nhi·ªát.", "C. H·∫•p th·ª• nhi·ªát l∆∞·ª£ng t·ª´ m√¥i tr∆∞·ªùng.", "D. L√†m tƒÉng enthalpy c·ªßa h·ªá."], a: 1 },
        { type: 1, q: "C√¥ng th·ª©c t√≠nh bi·∫øn thi√™n enthalpy chu·∫©n c·ªßa ph·∫£n ·ª©ng Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> d·ª±a v√†o nƒÉng l∆∞·ª£ng li√™n k·∫øt (E<sub>b</sub>) l√†:", opts: ["A. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëE<sub>b</sub>(sp)", "B. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëE<sub>b</sub>(cd) x ‚àëE<sub>b</sub>(sp)", "C. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëE<sub>b</sub>(cd) - ‚àëE<sub>b</sub>(sp)", "D. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëE<sub>b</sub>(cd) + ‚àëE<sub>b</sub>(sp)"], a: 2 },
        { type: 1, q: "C√¥ng th·ª©c t√≠nh bi·∫øn thi√™n enthalpy chu·∫©n c·ªßa ph·∫£n ·ª©ng Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> d·ª±a v√†o enthalpy t·∫°o th√†nh (Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>) l√†", opts: ["A. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(sp) + ‚àëŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(cd)", "B. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(sp) - ‚àëŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(cd)", "C. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(sp) x ‚àëŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(cd)", "D. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = ‚àëŒî<sub>f</sub>H<sup>0</sup><sub>298</sub>(cd)"], a: 1 },
        { type: 1, q: "Ph·∫£n ·ª©ng t·ªèa nhi·ªát l√† ph·∫£n ·ª©ng c√≥ gi√° tr·ªã Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> nh∆∞ th·∫ø n√†o?", opts: ["A. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> > 0", "B. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = 0", "C. Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> < 0", "D. 0 < Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> < 1"], a: 2 },
        { type: 1, q: "Ph·∫£n ·ª©ng quang h·ª£p c·ªßa c√¢y xanh (6CO<sub>2</sub> + 6H<sub>2</sub>O ‚Üí C<sub>6</sub>H<sub>12</sub>O<sub>6</sub> + 6O<sub>2</sub>) c√≥ Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = + 2803 kJ. ƒê√¢y l√† ph·∫£n ·ª©ng", opts: ["A. T·ªèa nhi·ªát.", "B. Thu nhi·ªát.", "C. Oxi h√≥a kh·ª≠ kh√¥ng thay ƒë·ªïi nhi·ªát.", "D. T·ª± x·∫£y ra ·ªü m·ªçi ƒëi·ªÅu ki·ªán."], a: 1 },
        { type: 1, q: "T·∫°i sao nitrogen (N‚â°N) r·∫•t b·ªÅn v√† ch·ªâ ph·∫£n ·ª©ng ·ªü nhi·ªát ƒë·ªô cao ho·∫∑c c√≥ tia l·ª≠a ƒëi·ªán?", opts: ["A. V√¨ ph√¢n t·ª≠ Nitrogen c√≥ kh·ªëi l∆∞·ª£ng nh·ªè.", "B. V√¨ nƒÉng l∆∞·ª£ng li√™n k·∫øt ba N‚â°N r·∫•t l·ªõn (945 kJ/mol).", "C. V√¨ Nitrogen l√† kh√≠ hi·∫øm.", "D. V√¨ Nitrogen kh√¥ng tan trong n∆∞·ªõc."], a: 1 },
        { type: 1, q: "ƒê·ªëi v·ªõi ph·∫£n ·ª©ng ƒë·ªët ch√°y nhi√™n li·ªáu (nh∆∞ gas, xƒÉng, methane...), ƒë·∫∑c ƒëi·ªÉm n√†o sau ƒë√¢y l√† ƒë√∫ng?", opts: ["A. L√† ph·∫£n ·ª©ng thu nhi·ªát, l√†m m√¥i tr∆∞·ªùng l·∫°nh ƒëi.", "B. L√† ph·∫£n ·ª©ng t·ªèa nhi·ªát, gi·∫£i ph√≥ng nƒÉng l∆∞·ª£ng l·ªõn.", "C. C√≥ bi·∫øn thi√™n enthalpy d∆∞∆°ng (Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> > 0).", "D. Kh√¥ng c√≥ s·ª± thay ƒë·ªïi v·ªÅ nƒÉng l∆∞·ª£ng."], a: 1 },
        { type: 1, q: "Cho c√°c gi√° tr·ªã nhi·ªát t·∫°o th√†nh chu·∫©n: Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(CO<sub>2</sub>) = -393,5 kJ/mol; Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(CO) = -110,50 kJ/mol; Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(N<sub>2</sub>O) = 82,05 kJ/mol; Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>(N<sub>2</sub>O<sub>4</sub>) = 9,16 kJ/mol. T√≠nh Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> c·ªßa ph·∫£n ·ª©ng: N<sub>2</sub>O<sub>4</sub>(g) + 3CO(g) ‚Üí N<sub>2</sub>O(g) + 3CO<sub>2</sub>(g).", opts: ["A. -776,11 kJ.", "B. +776,11 kJ.", "C. -300,5 kJ.", "D. -500,2 kJ."], a: 0 },
        { type: 1, q: "ƒê∆°n v·ªã th∆∞·ªùng d√πng cho nƒÉng l∆∞·ª£ng li√™n k·∫øt (E<sub>b</sub>) v√† enthalpy t·∫°o th√†nh chu·∫©n (Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>) l√†", opts: ["A. kJ/mol.", "B. kg/mol.", "C. Pa.", "D. L√≠t."], a: 0 },
        { type: 1, q: "D·ª±a v√†o nƒÉng l∆∞·ª£ng li√™n k·∫øt: E<sub>b</sub>(H-H)= 432 kJ/mol; E<sub>b</sub>(Cl-Cl)=243 kJ/mol; E<sub>b</sub>(H-Cl)=427 kJ/mol. Bi·∫øn thi√™n enthalpy c·ªßa ph·∫£n ·ª©ng H<sub>2</sub>(g) + Cl<sub>2</sub>(g) ‚Üí 2HCl(g) l√†", opts: ["A. -179 kJ.", "B. +179 kJ.", "C. -854 kJ.", "D. +675 kJ."], a: 0 },
        { type: 1, q: "T√≠nh Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> c·ªßa ph·∫£n ·ª©ng t·ªïng h·ª£p ammonia: 3H<sub>2</sub>(g) + N<sub>2</sub>(g) ‚Üí 2NH<sub>3</sub>(g). Bi·∫øt E<sub>b</sub>(H-H)= 432; E<sub>b</sub>(N‚â°N)= 945; E<sub>b</sub>(N-H)= 391 (ƒë∆°n v·ªã kJ/mol).", opts: ["A. -105 kJ.", "B. +105 kJ.", "C. -93 kJ.", "D. +200 kJ."], a: 0 },
        
        // Type 2: ƒê√∫ng/Sai t·ª´ Ph·∫ßn 2 (T√°ch ri√™ng t·ª´ng √Ω theo chu·∫©n E-learning) (8 c√¢u)
        { type: 2, q: "Qu√° tr√¨nh ph√° v·ª° c√°c li√™n k·∫øt h√≥a h·ªçc trong ch·∫•t ƒë·∫ßu lu√¥n c·∫ßn cung c·∫•p nƒÉng l∆∞·ª£ng.", a: 0 }, // ƒê√∫ng
        { type: 2, q: "Ph·∫£n ·ª©ng t·ªèa nhi·ªát c√≥ gi√° tr·ªã bi·∫øn thi√™n enthalpy chu·∫©n l·ªõn h∆°n 0 (Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> > 0).", a: 1 }, // Sai
        { type: 2, q: "Ph·∫£n ·ª©ng ƒë·ªët ch√°y kh√≠ methane (CH<sub>4</sub>) trong kh√¥ng kh√≠ l√† ph·∫£n ·ª©ng t·ªèa nhi·ªát.", a: 0 }, // ƒê√∫ng
        { type: 2, q: "Khi t√≠nh Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> d·ª±a v√†o nƒÉng l∆∞·ª£ng li√™n k·∫øt E<sub>b</sub>, ta l·∫•y t·ªïng E<sub>b</sub> c·ªßa s·∫£n ph·∫©m tr·ª´ ƒëi t·ªïng E<sub>b</sub> c·ªßa ch·∫•t ƒë·∫ßu.", a: 1 }, // Sai
        { type: 2, q: "Qu√° tr√¨nh quang h·ª£p c·ªßa c√¢y xanh l√† m·ªôt v√≠ d·ª• ƒëi·ªÉn h√¨nh v·ªÅ ph·∫£n ·ª©ng t·ªèa nhi·ªát.", a: 1 }, // Sai
        { type: 2, q: "Khi t√≠nh Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> d·ª±a v√†o nhi·ªát t·∫°o th√†nh Œî<sub>f</sub>H<sup>0</sup><sub>298</sub>, ta l·∫•y t·ªïng nhi·ªát t·∫°o th√†nh c·ªßa c√°c ch·∫•t s·∫£n ph·∫©m tr·ª´ ƒëi t·ªïng nhi·ªát t·∫°o th√†nh c·ªßa c√°c ch·∫•t ƒë·∫ßu.", a: 0 }, // ƒê√∫ng
        { type: 2, q: "Nitrogen (N<sub>2</sub>) ho·∫°t ƒë·ªông h√≥a h·ªçc m·∫°nh ·ªü nhi·ªát ƒë·ªô th∆∞·ªùng do c√≥ li√™n k·∫øt ba b·ªÅn v·ªØng.", a: 1 }, // Sai
        { type: 2, q: "C√°c ph·∫£n ·ª©ng c√≥ Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> < 0 th∆∞·ªùng l√†m tƒÉng nhi·ªát ƒë·ªô c·ªßa m√¥i tr∆∞·ªùng xung quanh.", a: 0 }, // ƒê√∫ng

        // Type 3: Tr·∫£ l·ªùi ng·∫Øn t·ª´ Ph·∫ßn 3 (4 c√¢u)
        { type: 3, q: "Cho bi·∫øt ph·∫£n ·ª©ng t·∫°o th√†nh 2 mol HCl(g) ·ªü ƒëi·ªÅu ki·ªán chu·∫©n t·ªèa ra 184,6kJ: H<sub>2</sub>(g) + Cl<sub>2</sub>(g) ‚Üí 2HCl(g) (*). C√≥ m·∫•y ph√°t bi·ªÉu ƒë√∫ng trong 4 ph√°t bi·ªÉu sau? (a) Nhi·ªát t·∫°o th√†nh c·ªßa HCl l√† ‚Äì184,6 kJ. (b) Bi·∫øn thi√™n enthalpy ph·∫£n ·ª©ng (*) l√† ‚Äì184,6 kJ. (c) Nhi·ªát t·∫°o th√†nh c·ªßa HCl l√† ‚Äì92,3 kJ. (d) Bi·∫øn thi√™n enthalpy ph·∫£n ·ª©ng (*) l√† ‚Äì92,3 kJ.", a: "2" },
        { type: 3, q: "C√≥ m·∫•y ph√°t bi·ªÉu ƒë√∫ng? (a) Bi·∫øn thi√™n enthalpy chu·∫©n l√† nhi·ªát k√®m theo ·ªü 1 atm v√† 25oC. (b) Nhi·ªát k√®m theo ·ªü 1 bar v√† 298K l√† bi·∫øn thi√™n enthalpy chu·∫©n. (c) Ph·∫£n ·ª©ng l√†m m√¥i tr∆∞·ªùng n√≥ng l√™n l√† thu nhi·ªát. (d) Ph·∫£n ·ª©ng l√†m m√¥i tr∆∞·ªùng l·∫°nh ƒëi l√† thu nhi·ªát.", a: "2" },
        { type: 3, q: "Cho E<sub>b</sub>(C-H) = 418 kJ/mol; E<sub>b</sub>(C-C) = 346 kJ/mol; E<sub>b</sub>(C=C) = 612 kJ/mol. Bi·∫øn thi√™n enthalpy c·ªßa ph·∫£n ·ª©ng: C<sub>3</sub>H<sub>8</sub>(g) ‚Üí CH<sub>4</sub>(g) + C<sub>2</sub>H<sub>4</sub>(g) c√≥ gi√° tr·ªã bao nhi√™u kJ?", a: "80" },
        { type: 3, q: "Cho ph∆∞∆°ng tr√¨nh: SO<sub>2</sub>(g) + 1/2 O<sub>2</sub>(g) ‚Üí SO<sub>3</sub>(g) c√≥ Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> = -98,5 kJ. Gi√° tr·ªã Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> c·ªßa ph·∫£n ·ª©ng ng∆∞·ª£c l·∫°i SO<sub>3</sub>(g) ‚Üí SO<sub>2</sub>(g) + 1/2 O<sub>2</sub>(g) l√† bao nhi√™u? (ghi r√µ d·∫•u + n·∫øu c√≥)", a: "+98,5" },

        // Th√™m 1 c√¢u t·ª± lu·∫≠n (Type 4) tr√≠ch t·ª´ n·ªôi dung L√Ω thuy·∫øt ƒë·ªÉ ƒë·ªß 25 c√¢u (1 c√¢u)
        { type: 4, q: "H√£y n√™u nguy√™n t·∫Øc chung t√≠nh bi·∫øn thi√™n enthalpy chu·∫©n c·ªßa ph·∫£n ·ª©ng Œî<sub>r</sub>H<sup>0</sup><sub>298</sub> d·ª±a v√†o enthalpy t·∫°o th√†nh chu·∫©n.", k: ["s·∫£n ph·∫©m", "tr·ª´", "ch·∫•t ƒë·∫ßu", "t·∫°o th√†nh"] }
    ];

    // --- BI·∫æN TO√ÄN C·ª§C ---
    let soundEnabled = true;
    let audioCtx = null;
    let learnedSubs = new Set();
    const TOTAL_LEARN_ITEMS = 7; // I.1 (CT, VD), I.2 (CT, VD), P1, P2, P3
    let isContentCompleted = false;

    // Tr·∫°ng th√°i Quiz
    let currentQuizCode = "";
    let N = 10;
    let activeQuestions = [];
    let currentQIndex = 0;
    let answersLog = [];
    let score = 0;
    let hasSubmitted = false;

    // --- KH·ªûI T·∫†O √ÇM THANH ---
    function initAudio() {
        if(!audioCtx) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if(AudioContext) audioCtx = new AudioContext();
        }
    }
    function toggleSound() {
        soundEnabled = !soundEnabled;
        document.getElementById('sound-icon').innerText = soundEnabled ? 'üîä' : 'üîá';
    }
    function playSound(isGood) {
        if(!soundEnabled) return;
        initAudio();
        if(!audioCtx) return;
        if(audioCtx.state === 'suspended') audioCtx.resume();
        try {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if(isGood) {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(300, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(150, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                osc.start(); osc.stop(audioCtx.currentTime + 0.2);
            }
        } catch(e) {}
    }

    // --- RENDER MENU & KI·ªÇM SO√ÅT H·ªåC T·∫¨P ---
    function renderMenu() {
        const container = document.getElementById('menu-container');
        container.innerHTML = '';
        lessonData.forEach(l1 => {
            const d1 = document.createElement('div');
            d1.innerHTML = `<div style="color:var(--menu-btn-bg); font-weight:bold; margin-bottom:10px;">${l1.title}</div>`;
            container.appendChild(d1);

            l1.subs.forEach(l2 => {
                const btn2 = document.createElement('button');
                btn2.className = 'menu-btn';
                btn2.innerText = l2.title;
                const subDiv2 = document.createElement('div');
                subDiv2.className = 'submenu-container';
                
                let firstModalTrigger = null;

                if (l2.subs && l2.subs.length > 0) {
                    l2.subs.forEach(l3 => {
                        if (l3.items && l3.items.length > 0) {
                            // C·∫•p ti√™u ƒë·ªÅ ph·ª• (VD: I.1. X√°c ƒë·ªãnh...)
                            const d3 = document.createElement('div');
                            d3.style.color = '#fff';
                            d3.style.fontWeight = 'bold';
                            d3.style.padding = '8px 0 4px 0';
                            d3.style.fontSize = '0.9rem';
                            d3.innerText = l3.title;
                            subDiv2.appendChild(d3);

                            l3.items.forEach((item, idx) => {
                                const itemDiv = document.createElement('div');
                                itemDiv.className = 'submenu-item';
                                itemDiv.id = `learn-${l3.id}-${idx}`;
                                itemDiv.innerText = "‚Ä¢ " + item.t;
                                itemDiv.onclick = () => {
                                    markLearned(itemDiv.id);
                                    openModalContent(item.t, item.c);
                                };
                                subDiv2.appendChild(itemDiv);
                                
                                // L∆∞u h√†nh ƒë·ªông m·ªü modal c·ªßa m·ª•c ƒë·∫ßu ti√™n
                                if (!firstModalTrigger) firstModalTrigger = itemDiv.onclick;
                            });
                        } else if (l3.type === "quiz") {
                            // C·∫•p m·ª•c con m·ªü quiz (VD: Ph·∫ßn 1, Ph·∫ßn 2)
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'submenu-item';
                            itemDiv.id = `learn-${l3.id}`;
                            itemDiv.innerText = l3.title;
                            itemDiv.onclick = () => {
                                markLearned(itemDiv.id);
                                openModalQuiz(l3.title, l3.questions);
                            };
                            subDiv2.appendChild(itemDiv);
                            
                            // L∆∞u h√†nh ƒë·ªông m·ªü modal c·ªßa m·ª•c ƒë·∫ßu ti√™n
                            if (!firstModalTrigger) firstModalTrigger = itemDiv.onclick;
                        } else {
                            // Sub item text th√¥ng th∆∞·ªùng
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'submenu-item';
                            itemDiv.id = `learn-${l3.id}`;
                            itemDiv.innerText = l3.title;
                            itemDiv.onclick = () => {
                                markLearned(itemDiv.id);
                                openModalContent(l3.title, l3.content || "N·ªôi dung ƒëang c·∫≠p nh·∫≠t...");
                            };
                            subDiv2.appendChild(itemDiv);
                            if (!firstModalTrigger) firstModalTrigger = itemDiv.onclick;
                        }
                    });
                }

                // X·ª≠ l√Ω s·ª± ki·ªán b·∫•m m·ª•c c·∫•p cha
                btn2.onclick = () => {
                    const isOpening = subDiv2.style.display !== 'block';
                    subDiv2.style.display = isOpening ? 'block' : 'none';
                    
                    // Ch·ªâ b·∫≠t modal n·∫øu tr·∫°ng th√°i l√† ƒëang M·ªû submenu
                    if (isOpening) {
                        if (firstModalTrigger) {
                            firstModalTrigger(); // G·ªçi h√†m click c·ªßa m·ª•c con ƒë·∫ßu ti√™n
                        } else {
                            // M·ªü modal b√°o ch∆∞a c√≥ n·ªôi dung n·∫øu r·ªóng
                            openModalContent(l2.title, "M·ª•c n√†y ch∆∞a c√≥ n·ªôi dung. Vui l√≤ng ch·ªçn m·ª•c con.");
                        }
                    }
                };

                container.appendChild(btn2);
                container.appendChild(subDiv2);
            });
        });
    }

    function markLearned(id) {
        learnedSubs.add(id);
        const el = document.getElementById(id);
        if(el) el.classList.add('completed');
        checkCompletion();
    }

    function checkCompletion() {
        if(learnedSubs.size >= TOTAL_LEARN_ITEMS && !isContentCompleted) {
            const btn = document.getElementById('btn-complete-content');
            btn.style.display = 'block';
            btn.disabled = false;
        }
    }

    function completeContent() {
        isContentCompleted = true;
        document.getElementById('btn-complete-content').innerText = "ƒê√É HO√ÄN TH√ÄNH";
        document.getElementById('btn-complete-content').disabled = true;
        
        // M·ªü kh√≥a c·ªôt ph·∫£i
        document.getElementById('hs-ma').disabled = false;
        document.getElementById('hs-ten').disabled = false;
        document.getElementById('hs-lop').disabled = false;
        document.getElementById('numQuestions').disabled = false;
        document.getElementById('btn-start').disabled = false;
        alert("B·∫°n ƒë√£ ho√†n th√†nh n·ªôi dung l√Ω thuy·∫øt. H√£y ƒëi·ªÅn th√¥ng tin ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i!");
    }

    // --- MODALS ---
    function openModalContent(title, htmlContent) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-body-content').innerHTML = htmlContent;
        document.getElementById('content-modal').style.display = 'flex';
    }

    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
        if(id === 'content-modal') {
            document.getElementById('modal-body-content').innerHTML = '';
        }
    }

    // Modal h·ªçc t·∫≠p cho ph·∫ßn b√†i t·∫≠p
    let tempModalQIndex = 0;
    let tempModalQuestions = [];
    let tempModalCorrect = 0;
    let tempModalWrong = 0;
    let tempUserAnswer = null;
    let tempModalAnswersLog = []; // Bi·∫øn l∆∞u l·ªãch s·ª≠ ri√™ng cho ph·∫ßn b√†i t·∫≠p

    function openModalQuiz(title, qIndices) {
        tempModalQuestions = qIndices.map(i => qBank[i]);
        tempModalQIndex = 0;
        tempModalCorrect = 0;
        tempModalWrong = 0;
        tempModalAnswersLog = []; // Reset log m·ªói khi m·ªü ph·∫ßn m·ªõi
        document.getElementById('modal-title').innerText = title;
        renderModalQuizStep();
        document.getElementById('content-modal').style.display = 'flex';
    }
    
    function renderModalQuizStep() {
        if(tempModalQIndex >= tempModalQuestions.length) {
            document.getElementById('modal-body-content').innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h2 style="color:var(--success); margin-bottom: 20px; text-transform: uppercase;">ƒê√É HO√ÄN TH√ÄNH PH·∫¶N B√ÄI T·∫¨P</h2>
                    <div style="font-size: 1.5rem; margin-bottom: 10px; font-weight: bold; color: var(--success);">
                        S·ªë c√¢u ƒë√∫ng: ${tempModalCorrect} / ${tempModalQuestions.length}
                    </div>
                    <div style="font-size: 1.5rem; margin-bottom: 20px; font-weight: bold; color: var(--error);">
                        S·ªë c√¢u sai: ${tempModalWrong} / ${tempModalQuestions.length}
                    </div>
                    <div style="display: flex; justify-content: center; gap: 15px;">
                        <button class="btn-action" style="width: auto; padding: 10px 30px; background: var(--info);" onclick="openModalQuizReview()">XEM K·∫æT QU·∫¢</button>
                        <button class="btn-action" style="width: auto; padding: 10px 30px; background: var(--error);" onclick="closeModal('content-modal')">ƒê√ìNG</button>
                    </div>
                </div>
            `;
            return;
        }
        
        tempUserAnswer = null; // Reset ƒë√°p √°n c·ªßa c√¢u m·ªõi
        const q = tempModalQuestions[tempModalQIndex];
        
        let html = `<div style="font-weight:bold; margin-bottom:10px; color: var(--info); font-size: 1.1rem;">C√¢u ${tempModalQIndex + 1}/${tempModalQuestions.length}</div>`;
        html += `<div style="margin-bottom:20px; font-size: 1.2rem; line-height: 1.5;">${q.q}</div>`;
        html += `<div class="options-container" id="modal-ans-container">`;
        
        if(q.type === 1) {
            q.opts.forEach((o, i) => {
                html += `<div class="option-btn" onclick="selectModalOpt(this, 1)" data-idx="${i}">${o}</div>`;
            });
        } else if(q.type === 2) {
            html += `<div class="option-btn" onclick="selectModalOpt(this, 2)" data-val="0">ƒê√∫ng</div>`;
            html += `<div class="option-btn" onclick="selectModalOpt(this, 2)" data-val="1">Sai</div>`;
        } else if(q.type === 3) {
            html += `<input type="text" id="modal-ans-input" class="input-text" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." oninput="tempUserAnswer = this.value">`;
        }
        
        html += `</div>`;
        html += `<button class="btn-action" style="margin-top: 20px;" onclick="nextModalQuiz()">C√ÇU TI·∫æP THEO ‚Üí</button>`;
        
        document.getElementById('modal-body-content').innerHTML = html;
    }

    function selectModalOpt(el, type) {
        const container = document.getElementById('modal-ans-container');
        Array.from(container.children).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        
        if(type === 1) {
            tempUserAnswer = parseInt(el.getAttribute('data-idx'));
        } else if(type === 2) {
            tempUserAnswer = parseInt(el.getAttribute('data-val'));
        }
    }

    function nextModalQuiz() {
        const q = tempModalQuestions[tempModalQIndex];
        let isCorrect = false;
        let uAnsStr = "";
        let sAnsStr = "";

        // Ki·ªÉm tra input, ch·∫•m ƒëi·ªÉm v√† l·∫•y chu·ªói ƒë√°p √°n
        if(q.type === 1) {
            if(tempUserAnswer === null) {
                alert("Vui l√≤ng ch·ªçn m·ªôt ƒë√°p √°n tr∆∞·ªõc khi chuy·ªÉn c√¢u!");
                return;
            }
            isCorrect = (tempUserAnswer === q.a);
            uAnsStr = q.opts[tempUserAnswer];
            sAnsStr = q.opts[q.a];
        } else if(q.type === 2) {
            if(tempUserAnswer === null) {
                alert("Vui l√≤ng ch·ªçn m·ªôt ƒë√°p √°n tr∆∞·ªõc khi chuy·ªÉn c√¢u!");
                return;
            }
            isCorrect = (tempUserAnswer === q.a);
            uAnsStr = tempUserAnswer === 0 ? "ƒê√∫ng" : "Sai";
            sAnsStr = q.a === 0 ? "ƒê√∫ng" : "Sai";
        } else if(q.type === 3) {
            const input = document.getElementById('modal-ans-input');
            const val = input ? input.value.trim() : "";
            if(!val) {
                alert("Vui l√≤ng nh·∫≠p c√¢u tr·∫£ l·ªùi tr∆∞·ªõc khi chuy·ªÉn c√¢u!");
                return;
            }
            // G·ªçi h√†m normalizeText ƒë√£ c√≥ s·∫µn c·ªßa Quiz t·ªïng
            const normUser = normalizeText(val);
            const normSys = normalizeText(q.a.toString());
            isCorrect = (normUser === normSys || normUser.replace(/-/g,'') === normSys.replace(/-/g,''));
            uAnsStr = val;
            sAnsStr = q.a;
        }

        // L∆∞u k·∫øt qu·∫£ ƒë·∫øm
        if(isCorrect) {
            tempModalCorrect++;
        } else {
            tempModalWrong++;
        }

        // L∆∞u log chi ti·∫øt cho ph·∫ßn xem k·∫øt qu·∫£
        tempModalAnswersLog.push({
            qHTML: q.q,
            uAns: uAnsStr,
            sAns: sAnsStr,
            correct: isCorrect
        });

        // Chuy·ªÉn c√¢u
        tempModalQIndex++;
        renderModalQuizStep();
    }

    // TH√äM M·ªöI: H√†m x·ª≠ l√Ω Review cho Modal B√†i T·∫≠p
    function openModalQuizReview() {
        const tbody = document.getElementById('modal-quiz-review-tbody');
        tbody.innerHTML = "";
        tempModalAnswersLog.forEach((ans, i) => {
            const tr = document.createElement('tr');
            tr.className = ans.correct ? "review-row-correct" : "review-row-wrong";
            
            const tSys = document.createElement('td');
            tSys.innerHTML = `<b>C√¢u ${i+1}:</b> ${ans.qHTML}<br><br><span style="color:var(--info)">H·ªá th·ªëng:</span> ${ans.sAns}`;
            
            const tUsr = document.createElement('td');
            tUsr.innerHTML = `<span style="color:${ans.correct ? 'var(--success)' : 'var(--error)'}">B√†i l√†m:</span> ${ans.uAns}`;
            
            tr.appendChild(tSys);
            tr.appendChild(tUsr);
            tbody.appendChild(tr);
        });
        document.getElementById('modal-quiz-review').style.display = 'flex';
    }

    function closeModalQuizReview() {
        document.getElementById('modal-quiz-review').style.display = 'none';
        // Khi ƒë√≥ng overlay review, overlay content-modal (ch·ª©a b·∫£ng ƒëi·ªÉm) v·∫´n gi·ªØ nguy√™n ph√≠a d∆∞·ªõi
    }

    // --- HI·ªÇN TH·ªä CH√çNH ---
    function showIntro() {
        const display = document.getElementById('display-content');
        display.innerHTML = `
            <div class="intro-view">
                <div class="intro-title">T√çNH ENTHALPY C·ª¶A PH·∫¢N ·ª®NG</div>
                <div class="intro-subtitle">T√≠nh enthalpy c·ªßa ph·∫£n ·ª©ng d·ª±a v√†o nƒÉng l∆∞·ª£ng li√™n k·∫øt v√† enthalpy t·∫°o th√†nh</div>
                <p style="color:#aaa; max-width:80%;">Vui l√≤ng h·ªçc ph·∫ßn n·ªôi dung b√™n tr√°i, sau ƒë√≥ nh·∫≠p th√¥ng tin ·ªü c·ªôt ph·∫£i ƒë·ªÉ B·∫ÆT ƒê·∫¶U L√ÄM B√ÄI.</p>
            </div>
        `;
    }

    function calculateDist() {
        let nInput = document.getElementById('numQuestions');
        let n = parseInt(nInput.value);
        if(isNaN(n) || n < 5) n = 5;
        if(n > 25) { n = 25; alert("S·ªë c√¢u t·ªëi ƒëa trong ng√¢n h√†ng l√† 25."); }
        nInput.value = n;
        N = n;

        let tf = Math.floor(N * 0.2);
        let sa = Math.floor(N * 0.2);
        let es = Math.floor(N * 0.2);
        let mcq = N - (tf + sa + es); // G·ªôp ph·∫ßn d∆∞

        document.getElementById('dist-mcq').innerText = mcq;
        document.getElementById('dist-tf').innerText = tf;
        document.getElementById('dist-sa').innerText = sa;
        document.getElementById('dist-es').innerText = es;
        
        return { mcq, tf, sa, es };
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function prepareQuestion(qOriginal) {
        let q = JSON.parse(JSON.stringify(qOriginal)); // clone
        if(q.type === 1) {
            let optsWithIndex = q.opts.map((o, i) => ({ text: o, isCorrect: i === q.a }));
            shuffleArray(optsWithIndex);
            // X√≥a ch·ªØ c√°i A, B, C, D c≈© n·∫øu c√≥ ·ªü ƒë·∫ßu
            q.opts = optsWithIndex.map((o, i) => {
                let cleanText = o.text.replace(/^[A-D]\.\s*/, '');
                return `${String.fromCharCode(65 + i)}. ${cleanText}`;
            });
            q.a = optsWithIndex.findIndex(o => o.isCorrect);
        }
        return q;
    }

    function startGame() {
        const ma = document.getElementById('hs-ma').value.trim();
        const ten = document.getElementById('hs-ten').value.trim();
        const lop = document.getElementById('hs-lop').value.trim();
        
        if(!ma || !ten || !lop) {
            alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß M√£ h·ªçc sinh, H·ªç t√™n v√† L·ªõp!");
            return;
        }

        initAudio();
        currentQuizCode = "MD" + Math.floor(100000 + Math.random() * 900000);
        const dist = calculateDist();
        
        // Ph√¢n lo·∫°i ng√¢n h√†ng
        let pool1 = qBank.filter(q => q.type === 1);
        let pool2 = qBank.filter(q => q.type === 2);
        let pool3 = qBank.filter(q => q.type === 3);
        let pool4 = qBank.filter(q => q.type === 4);

        shuffleArray(pool1); shuffleArray(pool2); shuffleArray(pool3); shuffleArray(pool4);

        let selectedQ = [];
        selectedQ = selectedQ.concat(pool1.slice(0, dist.mcq));
        selectedQ = selectedQ.concat(pool2.slice(0, dist.tf));
        selectedQ = selectedQ.concat(pool3.slice(0, dist.sa));
        selectedQ = selectedQ.concat(pool4.slice(0, dist.es));

        activeQuestions = shuffleArray(selectedQ).map(q => prepareQuestion(q));
        currentQIndex = 0;
        answersLog = [];
        score = 0;
        hasSubmitted = false;

        toggleInputs(true);
        renderQuestion();
    }

    function toggleInputs(lock) {
        document.getElementById('hs-ma').disabled = lock;
        document.getElementById('hs-ten').disabled = lock;
        document.getElementById('hs-lop').disabled = lock;
        document.getElementById('numQuestions').disabled = lock;
        document.getElementById('btn-start').disabled = lock;
    }

    // --- LOGIC L√ÄM B√ÄI ---
    function renderQuestion() {
        if(currentQIndex >= activeQuestions.length) {
            showResult();
            return;
        }

        const q = activeQuestions[currentQIndex];
        const display = document.getElementById('display-content');
        
        let typeStr = "";
        if(q.type === 1) typeStr = "Tr·∫Øc nghi·ªám 4 l·ª±a ch·ªçn";
        if(q.type === 2) typeStr = "ƒê√∫ng/Sai";
        if(q.type === 3) typeStr = "Tr·∫£ l·ªùi ng·∫Øn";
        if(q.type === 4) typeStr = "T·ª± lu·∫≠n";

        let html = `
            <div class="quiz-header">
                <span>D·∫°ng b√†i: ${typeStr}</span>
                <span>M√£ ƒë·ªÅ: ${currentQuizCode} | C√¢u: ${currentQIndex + 1}/${activeQuestions.length}</span>
            </div>
            <div class="question-text">${q.q}</div>
            <div class="options-container" id="ans-container">
        `;

        if(q.type === 1) {
            q.opts.forEach((opt, idx) => {
                html += `<div class="option-btn" onclick="selectOpt(this, 1)" data-idx="${idx}">${opt}</div>`;
            });
        } else if (q.type === 2) {
            html += `<div class="option-btn" onclick="selectOpt(this, 2)" data-val="0">ƒê√∫ng</div>`;
            html += `<div class="option-btn" onclick="selectOpt(this, 2)" data-val="1">Sai</div>`;
        } else if (q.type === 3) {
            html += `<input type="text" id="ans-input" class="input-text" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi...">`;
        } else if (q.type === 4) {
            html += `<textarea id="ans-input" class="input-textarea" placeholder="Nh·∫≠p n·ªôi dung tr·∫£ l·ªùi..."></textarea>`;
        }

        html += `</div>
            <button id="btn-submit-ans" class="btn-action" onclick="submitAnswer()">TR·∫¢ L·ªúI</button>
            <button id="btn-next-ans" class="btn-action" style="display:none; background:var(--center-border); color:#000;" onclick="nextQuestion()">TI·∫æP THEO ‚Üí</button>
        `;
        display.innerHTML = html;
        display.scrollTop = 0; // Reset scroll v√πng l√†m b√†i
    }

    function selectOpt(el, type) {
        if(document.getElementById('btn-next-ans').style.display !== 'none') return; // ƒê√£ tr·∫£ l·ªùi
        
        const container = document.getElementById('ans-container');
        Array.from(container.children).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
    }

    function normalizeText(text) {
        return text.toLowerCase()
            .replace(/\s+/g, ' ')
            .replace(/\s*-\s*/g, '-')
            .replace(/\s*,\s*/g, ',')
            .trim();
    }

    function submitAnswer() {
        const q = activeQuestions[currentQIndex];
        let isCorrect = false;
        let userAnsStr = "";
        let sysAnsStr = "";

        if(q.type === 1) {
            const selected = document.querySelector('.option-btn.selected');
            if(!selected) { alert("Vui l√≤ng ch·ªçn 1 ƒë√°p √°n!"); return; }
            const uIdx = parseInt(selected.getAttribute('data-idx'));
            isCorrect = (uIdx === q.a);
            userAnsStr = selected.innerHTML;
            sysAnsStr = q.opts[q.a];
            
            selected.classList.add(isCorrect ? 'correct' : 'wrong');
            if(!isCorrect) {
                document.querySelector(`.option-btn[data-idx="${q.a}"]`).classList.add('correct');
            }

        } else if(q.type === 2) {
            const selected = document.querySelector('.option-btn.selected');
            if(!selected) { alert("Vui l√≤ng ch·ªçn ƒê√∫ng ho·∫∑c Sai!"); return; }
            const uVal = parseInt(selected.getAttribute('data-val'));
            isCorrect = (uVal === q.a);
            userAnsStr = uVal === 0 ? "ƒê√∫ng" : "Sai";
            sysAnsStr = q.a === 0 ? "ƒê√∫ng" : "Sai";

            selected.classList.add(isCorrect ? 'correct' : 'wrong');
            if(!isCorrect) {
                document.querySelector(`.option-btn[data-val="${q.a}"]`).classList.add('correct');
            }

        } else if(q.type === 3) {
            const input = document.getElementById('ans-input');
            const val = input.value.trim();
            if(!val) { alert("Vui l√≤ng nh·∫≠p c√¢u tr·∫£ l·ªùi!"); return; }
            
            const normUser = normalizeText(val);
            const normSys = normalizeText(q.a.toString());
            isCorrect = (normUser === normSys || normUser.replace(/-/g,'') === normSys.replace(/-/g,''));
            
            userAnsStr = val;
            sysAnsStr = q.a;
            input.disabled = true;
            input.classList.add(isCorrect ? 'input-correct' : 'input-wrong');

        } else if(q.type === 4) {
            const input = document.getElementById('ans-input');
            const val = input.value.trim();
            if(!val) { alert("Vui l√≤ng nh·∫≠p c√¢u tr·∫£ l·ªùi!"); return; }
            
            const normUser = val.toLowerCase();
            isCorrect = q.k.some(kw => normUser.includes(kw.toLowerCase()));
            
            userAnsStr = val;
            sysAnsStr = "√ù ch√≠nh: " + q.k.join(", ");
            input.disabled = true;
            input.classList.add(isCorrect ? 'input-correct' : 'input-wrong');
        }

        playSound(isCorrect);
        
        answersLog.push({
            qHTML: q.q,
            uAns: userAnsStr,
            sAns: sysAnsStr,
            correct: isCorrect
        });

        document.getElementById('btn-submit-ans').style.display = 'none';
        document.getElementById('btn-next-ans').style.display = 'block';
    }

    function nextQuestion() {
        currentQIndex++;
        renderQuestion();
    }

    // --- K·∫æT QU·∫¢ & N·ªòP B√ÄI ---
    function showResult() {
        const correctCount = answersLog.filter(a => a.correct).length;
        const total = activeQuestions.length;
        // ƒêi·ªÉm = (ƒë√∫ng * 10) / t·ªïng, l√†m tr√≤n 1 ch·ªØ s·ªë
        score = Math.round(((correctCount * 10) / total) * 10) / 10;
        
        let rankHtml = "";
        if(score >= 9) rankHtml = `<div class="rank-xs">XU·∫§T S·∫ÆC</div>`;
        else if(score >= 8) rankHtml = `<div class="rank-g">GI·ªéI</div>`;
        else if(score >= 5) rankHtml = `<div class="rank-k">KH√Å</div>`;
        else rankHtml = `<div class="rank-tb">C·∫¶N C·ªê G·∫ÆNG</div>`;

        const display = document.getElementById('display-content');
        display.innerHTML = `
            <div class="result-view">
                <h2>Ho√†n th√†nh b√†i ki·ªÉm tra!</h2>
                <div class="score-display">${score.toFixed(1)} <span style="font-size:1.5rem">/ 10</span></div>
                ${rankHtml}
                <div style="margin:15px 0; color:#ccc;">S·ªë c√¢u ƒë√∫ng: ${correctCount} / ${total}</div>
                <div id="submit-status" style="color:var(--info); font-weight:bold; height:20px; margin-bottom:10px;"></div>
                
                <div class="btn-group">
                    <button class="btn-result btn-review" onclick="openReview()">XEM K·∫æT QU·∫¢ B√ÄI L√ÄM</button>
                    <button class="btn-result btn-nop" id="btn-final-submit" onclick="submitToGoogle(${correctCount}, ${total})">N·ªòP B√ÄI</button>
                    <button class="btn-result btn-retry" onclick="resetGame()">L√ÄM L·∫†I</button>
                </div>
            </div>
        `;
    }

    function submitToGoogle(correctCount, totalCount) {
        if(hasSubmitted) return;

        const ma = document.getElementById('hs-ma').value;
        const ten = document.getElementById('hs-ten').value;
        const lop = document.getElementById('hs-lop').value;
        const btnSubmit = document.getElementById('btn-final-submit');
        const statusDiv = document.getElementById('submit-status');

        btnSubmit.disabled = true;
        statusDiv.innerText = "ƒêang g·ª≠i d·ªØ li·ªáu...";

        const payload = {
            hoTen: ten,
            lop: lop,
            diem: score,
            soDung: correctCount,
            tongSoCau: totalCount
        };

        fetch(WEB_APP_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify(payload)
        }).then(() => {
            hasSubmitted = true;
            statusDiv.innerText = "ƒê√É G·ª¨I B√ÄI TH√ÄNH C√îNG";
            statusDiv.style.color = "var(--success)";
        }).catch(err => {
            btnSubmit.disabled = false; // M·ªü l·∫°i n·∫øu l·ªói
            statusDiv.innerText = "L·ªói m·∫°ng. Vui l√≤ng th·ª≠ l·∫°i!";
            statusDiv.style.color = "var(--error)";
        });
    }

    function openReview() {
        const tbody = document.getElementById('review-tbody');
        tbody.innerHTML = "";
        answersLog.forEach((ans, i) => {
            const tr = document.createElement('tr');
            tr.className = ans.correct ? "review-row-correct" : "review-row-wrong";
            
            const tSys = document.createElement('td');
            tSys.innerHTML = `<b>C√¢u ${i+1}:</b> ${ans.qHTML}<br><br><span style="color:var(--info)">H·ªá th·ªëng:</span> ${ans.sAns}`;
            
            const tUsr = document.createElement('td');
            tUsr.innerHTML = `<span style="color:${ans.correct ? 'var(--success)' : 'var(--error)'}">B√†i l√†m:</span> ${ans.uAns}`;
            
            tr.appendChild(tSys);
            tr.appendChild(tUsr);
            tbody.appendChild(tr);
        });
        document.getElementById('review-modal').style.display = 'flex';
    }

    function resetGame() {
        toggleInputs(false);
        showIntro();
    }
    
    function resetAll() {
        // X√≥a th√¥ng tin ƒë√£ nh·∫≠p nh∆∞ng gi·ªØ nguy√™n tr·∫°ng th√°i h·ªçc n·ªôi dung
        document.getElementById('hs-ma').value = "";
        document.getElementById('hs-ten').value = "";
        document.getElementById('hs-lop').value = "";
        document.getElementById('numQuestions').value = 10;
        calculateDist();
        resetGame();
    }

    // --- INIT ---
    window.onload = () => {
        renderMenu();
        showIntro();
        calculateDist();
    };
</script>

</body>
</html>